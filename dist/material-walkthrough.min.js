!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):e.MaterialWalkthrough=n()}(this,function(){"use strict";!function(){function p(e){this.value=e}function e(o){var a,i;function l(e,n){try{var t=o[e](n),r=t.value;r instanceof p?Promise.resolve(r.value).then(function(e){l("next",e)},function(e){l("throw",e)}):s(t.done?"return":"normal",t.value)}catch(e){s("throw",e)}}function s(e,n){switch(e){case"return":a.resolve({value:n,done:!0});break;case"throw":a.reject(n);break;default:a.resolve({value:n,done:!1})}(a=a.next)?l(a.key,a.arg):i=null}this._invoke=function(r,o){return new Promise(function(e,n){var t={key:r,arg:o,resolve:e,reject:n,next:null};i?i=i.next=t:(a=i=t,l(r,o))})},"function"!=typeof o.return&&(this.return=void 0)}"function"==typeof Symbol&&Symbol.asyncIterator&&(e.prototype[Symbol.asyncIterator]=function(){return this}),e.prototype.next=function(e){return this._invoke("next",e)},e.prototype.throw=function(e){return this._invoke("throw",e)},e.prototype.return=function(e){return this._invoke("return",e)}}();var n=function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")},r=function(){function r(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,n,t){return n&&r(e.prototype,n),t&&r(e,t),e}}(),f=function(){function e(){n(this,e)}return r(e,null,[{key:"get",value:function(e){return"string"==typeof e?document.querySelector(e):e}},{key:"setStyle",value:function(n,t){Object.keys(t).forEach(function(e){n.style[e]=t[e]})}},{key:"appendTo",value:function(e,n){var t=document.createElement("div");t.innerHTML=n,e.appendChild(t.children[0])}},{key:"removeClass",value:function(e,n){e.classList.remove(n)}},{key:"addClass",value:function(e,n){e.classList.add(n)}}]),e}(),t=function(){function t(){n(this,t)}return r(t,null,[{key:"preventDefault",value:function(e){(e=e||window.event).preventDefault&&e.preventDefault(),e.returnValue=!1}},{key:"preventDefaultForScrollKeys",value:function(e){if(t.keys[e.keyCode])return t.preventDefault(e),!1}},{key:"disable",value:function(){f.setStyle(f.get("html"),{height:"100vh",overflow:"hidden"});var e=t.preventDefault,n=t.preventDefaultForScrollKeys;window.addEventListener&&window.addEventListener("DOMMouseScroll",e,!1),window.onwheel=e,window.onmousewheel=document.onmousewheel=e,window.ontouchmove=e,document.onkeydown=n}},{key:"enable",value:function(){f.setStyle(f.get("html"),{height:"",overflow:"auto"}),window.removeEventListener&&window.removeEventListener("DOMMouseScroll",t.preventDefault,!1),window.onmousewheel=document.onmousewheel=null,window.onwheel=null,window.ontouchmove=null,document.onkeydown=null}}]),t}();function i(e){var n,t=0==(e=""+e).indexOf("#"),r=0==e.indexOf("rgb");if(t&&(n=e.substr(1).match(7==e.length?/(\S{2})/g:/(\S{1})/g)))var o=parseInt(n[0],16),a=parseInt(n[1],16),i=parseInt(n[2],16);if(r&&(n=e.match(/(\d+){3}/g)))o=n[0],a=n[1],i=n[2];if(void 0!==o)return(299*o+587*a+114*i)/1e3}t.keys={37:1,38:1,39:1,40:1,32:1,33:1,34:1},function(e,n){void 0===n&&(n={});var t=n.insertAt;if(e&&"undefined"!=typeof document){var r=document.head||document.getElementsByTagName("head")[0],o=document.createElement("style");o.type="text/css","top"===t&&r.firstChild?r.insertBefore(o,r.firstChild):r.appendChild(o),o.styleSheet?o.styleSheet.cssText=e:o.appendChild(document.createTextNode(e))}}("/**\n * Copyright 2017 Esset Software LTD.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n\nbody {\n    margin: 0px; /* Having problems with getClientRects. Webkit apply 8px for maring in body. Reseting body */\n    position: relative; /* FIX FROM ISSUE #30 */\n}\n#walk-bounds {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100vw;\n    height: 100%;\n    z-index: 1000;\n    overflow: hidden;\n    pointer-events: none;\n}\n/* END */\n\n#walk-wrapper {\n    pointer-events: all;\n    transform: translateZ(0);\n    position: absolute;\n    color: white; /* @TODO: Decide the contrast color based on the bright of the main color */\n    z-index: 1000;\n    display: none;\n}\n#walk-wrapper.dark {\n  color: black;\n}\n\n#walk-wrapper.opened {\n    transition: 0.25s;\n}\n\n#walk-wrapper.closed {\n    height: 1000px !important;\n    width: 1000px !important;\n    opacity: 0;\n}\n\n#walk-wrapper.closed #walk-content-wrapper {\n    display: none;\n}\n\n#walk-wrapper:before {\n    content: '';\n    display: block;\n    position: absolute;\n    background: transparent;\n    border: solid 0vw;\n    border-radius: 50%;\n    border-color: inherit;\n    width: inherit;\n    height: inherit;\n    margin-top: 0vw;\n    margin-left: 0vw;\n    opacity: .9;\n    box-sizing: content-box !important;\n    transition: border-width 0.25s ease-in, margin 0.25s ease-in;\n}\n\n#walk-wrapper.opened:before {\n    border-width: 200vw;\n    margin-left: -200vw;\n    margin-top: -200vw;\n}\n\n#walk-wrapper:after {\n    content: ' ';\n    box-sizing: content-box;\n    position: absolute;\n    top: -1px;\n    left: -1px;\n    width: 100%;\n    height: 100%;\n    border: 1px solid white;\n    border-radius: 50%;\n    box-shadow: inset 0px 0px 10px rgba(0,0,0,0.5);\n}\n\n#walk-wrapper #walk-content-wrapper {\n    position: relative;\n    min-width: 200px;\n    width: 33vw;\n    font-family: 'Roboto', sans-serif;\n    font-size: 24px;\n    opacity: 1;\n    transition: 0.25s opacity;\n\n    /* DEFAULT POSITION */\n    top: 100%;\n    left: 100%;\n}\n\n#walk-wrapper:not(.opened) #walk-content-wrapper,\n#walk-wrapper.transiting #walk-content-wrapper {\n    opacity: 0;\n}\n\n#walk-wrapper #walk-action {\n    height: 36px;\n    padding: 0 2rem;\n    margin-top: 10px;\n    background-color: rgba(255, 255, 255, 0.2);\n    border: 0;\n    border-radius: 2px;\n    letter-spacing: 1px;\n    font-size: 15px;\n    font-weight: bold;\n    text-transform: uppercase;\n    color: white;\n    display: inline-block;\n    flex-flow: initial;\n}\n#walk-wrapper.dark #walk-action {\n  color: black;\n  background-color: rgba(0, 0, 0, 0.2);\n}\n\n#walk-wrapper #walk-action:hover {\n    background-color: rgba(255, 255, 255, 0.25);\n}\n#walk-wrapper.dark #walk-action:hover {\n  color: black;\n  background-color: rgba(0, 0, 0, 0.25);\n}\n\n\n/** small rules **/\n#walk-wrapper.opened.small:before {\n    border-width: 320px;\n    margin-left: -320px;\n    margin-top: -320px;\n}\n#walk-wrapper.small #walk-content-wrapper {\n  max-width: 300px;\n}\n\n#walk-wrapper.transiting.small:not(.animations-disabled) {\n    display: none !important;\n}\n\n@media (max-width: 750px) {\n    #walk-wrapper.opened.small:before {\n        border-width: 50vw;\n        margin-left: -50vw;\n        margin-top: -50vw;\n    }\n}\n\n/** animations-disabled rules **/\n#walk-wrapper.animations-disabled,\n#walk-wrapper.animations-disabled:before {\n    transition: 0s;\n}\n\n#walk-wrapper.animations-disabled:before {\n    transition: 0.25s opacity;\n}\n\n#walk-wrapper.opened.animations-disabled:before {\n    opacity: .9;\n}\n\n#walk-wrapper.animations-disabled:before,\n#walk-wrapper.transiting.animations-disabled:before,\n#walk-wrapper.closed.animations-disabled:before,\n#walk-wrapper.closed.animations-disabled {\n    opacity: 0;\n}\n\n/*\nTODO: Make it responsible with layout breakpoints.\n    * The walk border\n    * The content text\n*/\n@media all and (max-width: 768px) {\n    #walk-wrapper #walk-content-wrapper {\n        max-width: 270px;\n        font-size: 18px;\n    }\n}\n",{});var l={MSG:!0,WALK_CONTENT:!0,WALK_CONTENT_TOP:!0,WALK_LOCK:!0,WALK_SCROLL:!0,ERROR:!0,ALL:!0};function _(e,n){for(var t,r=arguments.length,o=Array(2<r?r-2:0),a=2;a<r;a++)o[a-2]=arguments[a];(l[e]||l.ALL)&&(t=console).log.apply(t,[e+": "+n].concat(o))}var e=function(){function w(){n(this,w)}return r(w,null,[{key:"_init",value:function(){f.appendTo(f.get("body"),w.ELEMENT_TEMPLATE),w._wrapper=f.get("#walk-wrapper"),w._contentWrapper=f.get("#walk-content-wrapper"),w._content=f.get("#walk-content"),w._actionButton=f.get("#walk-action"),w.DISABLE_HUGE_ANIMATIONS&&f.addClass(w._wrapper,"animations-disabled"),w.FORCE_SMALL_BORDER&&f.addClass(w._wrapper,"small"),w.isInitialized=!0}},{key:"_setWalker",value:function(e){var n=f.get(e.target);if(!n)return _("_setWalker","Target "+e.target+" not found. Skiping to next WalkPoint"),void w._next();_("MSG","-------------------------------------"),_("MSG","Setting a walk to #"+n.id),_("WALK_SETUP","Properties:\n"+JSON.stringify(e,null,2)),w._setupListeners(n,e.onClose),w._locateTarget(n,function(){w._setProperties(e.content,e.color,e.acceptText),f.setStyle(w._wrapper,{display:"block"}),w._renderFrame(n,function(){f.addClass(w._wrapper,"opened"),w._renderContent(n,function(){f.removeClass(w._wrapper,"transiting")},w._error(e)),w._renderContent(n,function(){f.removeClass(w._wrapper,"transiting")},w._error(e))})}),_("MSG","Walk created. Calling onSet() (if exists)"),e.onSet&&e.onSet()}},{key:"_createUpdateHandler",value:function(e){_("WALK_UPDATE","Creating UpdateHandler for #"+e.id);var n=function(){_("MSG","Updating and rendering"),w._locateTarget(e,function(){w._renderFrame(e,function(){w._renderContent(e,void 0,w._error())})})};return n.toString=function(){return"updateHandler -> #"+e.id},n}},{key:"_next",value:function(){!!w._instance.points&&!!w._instance.points[w._instance.currentIndex+1]?(w._instance.currentIndex++,w._setWalker(w._instance.points[w._instance.currentIndex])):(w._instance.currentIndex=0,w._instance.points=null,w._instance.onCloseCallback&&w._instance.onCloseCallback(),w._instance.onCloseCallback=null,w.closeWalker())}},{key:"_setupListeners",value:function(e,n){w._instance.updateHandler&&w._flushListeners(),w._instance.updateHandler=w._createUpdateHandler(e),window.addEventListener("resize",w._instance.updateHandler),w._instance.mutationObserver=new MutationObserver(w._instance.updateHandler),w._instance.mutationObserver.observe(document.body,{childList:!0,subtree:!0}),w._actionButton.addEventListener("click",function e(){n&&n(),f.addClass(w._wrapper,"transiting"),setTimeout(function(){w._next()},w.TRANSITION_DURATION),w._actionButton.removeEventListener("click",e)})}},{key:"_flushListeners",value:function(){_("WALK_UPDATER","Flushing handlers\n"+w._instance.updateHandler),w._instance.mutationObserver&&w._instance.mutationObserver.disconnect(),w._instance.mutationObserver=null,window.removeEventListener("resize",w._instance.updateHandler)}},{key:"_setProperties",value:function(e,n,t){var r=n||w.DEFAULT_COLOR;console.log(i(r));var o=i(r);if(127.916==o||122.966==o||126.36==o||134.569==o||(145.93!=o||139.462!=o||142.449!=o)&&138.872<o?f.addClass(w._wrapper,"dark"):f.removeClass(w._wrapper,"dark"),f.setStyle(w._wrapper,{borderColor:r}),w._content.innerHTML=e,w._actionButton.innerHTML=t||w.DEFAULT_ACCEPT_TEXT,!w.FORCE_SMALL_BORDER){var a=f.get('meta[name="theme-color"]');a&&a.setAttribute("content",r)}}},{key:"_locateTarget",value:function(e,n){var t=e.offsetTop,r=window.innerHeight,o=w.CURRENT_DOCUMENT_HEIGHT-window.innerHeight,a=t-r/2+e.getClientRects()[0].height/2,i=o<a?o:a;_("WALK_LOCK","Moving Scroll to:",i),_("WALK_LOCK","windowHeight:",r),window.scrollTo(0,i),n&&n()}},{key:"_renderFrame",value:function(e,n){var t=e.offsetTop,r=e.getClientRects()[0],o=r.height,a=r.width,i=r.left,l=a<o?o:a;l<w.MIN_SIZE&&(l=w.MIN_SIZE),_("WALK_LOCK","Walk hole size "+l+"px");var s={height:l+w.GUTTER+"px",width:l+w.GUTTER+"px",marginLeft:-(l+w.GUTTER)/2+"px",marginTop:-(l+w.GUTTER)/2+"px",left:i+a/2+"px",top:t+o/2+"px"};f.setStyle(w._wrapper,s),_("WALK_LOCK","Positioning \n"+JSON.stringify(s,2)),setTimeout(function(){n()},w.TRANSITION_DURATION/2)}},{key:"_renderContent",value:function(e,n,t){var r=w._wrapper.getBoundingClientRect(),o=r.left+(w._wrapper.offsetWidth-w.GUTTER)+w._contentWrapper.offsetWidth<window.innerWidth,a=0<r.left+w.GUTTER-w._contentWrapper.offsetWidth,i=0<r.top-w._contentWrapper.offsetHeight,l=r.top+w._contentWrapper.offsetHeight+w._wrapper.offsetHeight<window.innerHeight;_("WALK_CONTENT","itCanBeRenderedInRight: "+o),_("WALK_CONTENT","itCanBeRenderedInLeft: "+a),_("WALK_CONTENT","itCanBeRenderedInTop: "+i),_("WALK_CONTENT","itCanBeRenderedInBottom: "+l);var s="100%",p="100%",c=0,d=0,u="left";!1===o&&!1===a&&!1===i&&!1===l?t&&t(new Error("Cannot find a place to locate the walker, closing it, aborting walk !")):(o||(s=a?"-"+w._contentWrapper.offsetWidth+"px":"calc(50% - 100px)",u=a?"right":"center",c=a?0:l?"20px":"-20px"),l||(p=i?"-"+w._contentWrapper.offsetHeight+"px":w._wrapper.offsetHeight/2-w._contentWrapper.offsetHeight/2+"px",d=i?0:o?"20px":"-20px"),f.setStyle(w._contentWrapper,{left:s,top:p,textAlign:u,marginTop:c,marginLeft:d}),n&&n())}},{key:"walk",value:function(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{onComplete:null,onError:null};if(w._instance.points=e,w._instance.currentIndex=0,w._instance.onCloseCallback=n.onComplete,w._instance.onErrorCallback=n.onError,document.querySelector('meta[name="theme-color"]'))w.ORIGINAL_THEME_COLOR=document.querySelector('meta[name="theme-color"]').getAttribute("content");else{w.ORIGINAL_THEME_COLOR=null;var t=document.createElement("meta");t.name="theme-color",t.content="",document.querySelector("head").appendChild(t)}w.to(e[0])}},{key:"to",value:function(e){w.CURRENT_DOCUMENT_HEIGHT=document.querySelector("html").offsetHeight,t.disable(),w.isInitialized||w._init(),f.removeClass(w._wrapper,"closed"),w._setWalker(e)}},{key:"closeWalker",value:function(){_("MSG","Closing Walker"),w._flushListeners(),t.enable();var e=f.get('meta[name="theme-color"]');e&&e.setAttribute("content",w.ORIGINAL_THEME_COLOR),f.setStyle(w._wrapper,{marginTop:"-500px",marginLeft:"-500px"}),f.addClass(w._wrapper,"closed"),setTimeout(function(){f.setStyle(w._wrapper,{display:"none"}),f.removeClass(w._wrapper,"opened"),f.removeClass(w._wrapper,"transiting"),_("MSG","Walker Closed!")},w.TRANSITION_DURATION)}},{key:"_error",value:function(e){return(null!=w._instance.onErrorCallback?w._instance.onErrorCallback:function(e,n){console.warn(n.message,"Target : ",e),w.closeWalker()}).bind(void 0,e)}}]),w}();return e.CURRENT_DOCUMENT_HEIGHT=0,e.ORIGINAL_THEME_COLOR=null,e.DEFAULT_COLOR="#2196F3",e.DEFAULT_ACCEPT_TEXT="Ok",e.TRANSITION_DURATION=500,e.DISABLE_HUGE_ANIMATIONS=!1,e.FORCE_SMALL_BORDER=!1,e.MIN_SIZE=60,e.GUTTER=20,e.ELEMENT_TEMPLATE="<div id='walk-wrapper' class='"+(e.DISABLE_HUGE_ANIMATIONS?"animations-disabled":"")+" "+(e.FORCE_SMALL_BORDER?"small":"")+"'>\n      <div id='walk-content-wrapper'>\n        <div id='walk-content'></div>\n        <button id='walk-action'></button>\n      </div>\n    </div>",e.isInitialized=!1,e._wrapper=null,e._contentWrapper=null,e._content=null,e._actionButton=null,e._instance={updateHandler:null,mutationObserver:null,points:null,currentIndex:null,onCloseCallback:null,onErrorCallback:null},e});
